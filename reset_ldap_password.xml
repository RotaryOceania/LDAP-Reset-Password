<?xml version="1.0" encoding="utf-8" ?>
<flectra>
    <data>
    
        <template id="ldap_reset_password.rotary_web_login" inherit_id="web.login">
            <xpath expr="//label[@for='login']" position="replace">
                <label for="login">Username</label>
            </xpath>
            <xpath expr="//input[@name='login']" position="attributes">
                <attribute name="placeholder">Username</attribute>
            </xpath>
        </template>

        <template id="ldap_reset_password.signup_is_member" name="Sign up login">
            <t t-call="web.login_layout">
                <style>
                    .custom-question {
                        font-size: 24px;
                        font-weight: bold;
                        margin-bottom: 10px;
                    }

                    .custom-button {
                        width: 100%;
                        font-size: 18px;
                        padding: 10px;
                    }
                </style>
                <div class="container mt-5">
                    <div class="row">
                        <div class="col-12 text-center">
                            <p class="custom-question">Are you a Rotary International Member?</p>
                        </div>
                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-3 mb-2">
                            <a href="/web/signup" class="btn btn-success custom-button">Yes</a>
                        </div>
                        <div class="col-12 col-md-3 mb-2">
                            <a href="/web/signup_non_member" class="btn btn-primary custom-button">No</a>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.login" inherit_id="auth_signup.login" name="LDAP Reset Password">
            <!-- Modify the 'Reset Password' link -->
            <xpath expr="//a[@t-if='reset_password_enabled']" position="replace">
                <a t-if="reset_password_enabled" t-attf-href="/web/reset_ldap_password?{{ keep_query() }}">Reset Password</a>
            </xpath>
            <!-- Modify the 'Don't have an account?' link -->
            <xpath expr="//a[@t-if='signup_enabled']" position="replace">
                <a t-if="signup_enabled" t-attf-href="/web/is_member?{{ keep_query() }}">Don't have an account?</a>
            </xpath>
        </template>

        <template id="ldap_reset_password.signup" name="Sign up login">
            <t t-call="web.login_layout">
                <form class="oe_signup_form" role="form" method="post" t-if="not message">
                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <t t-call="ldap_reset_password.fields">
                        <t t-set="only_passwords" t-value="bool(token and not invalid_token)"/>
                    </t>

                    <p class="alert alert-danger" t-if="error" role="alert">
                        <t t-esc="error"/>
                    </p>
                    <input type="hidden" name="redirect" t-att-value="redirect"/>
                    <input type="hidden" name="token" t-att-value="token"/>
                    <div class="text-center oe_login_buttons pt-3">
                        <button type="submit" class="btn btn-primary btn-block"> Sign up</button>
                        <a t-attf-href="/web/login?{{ keep_query() }}" class="btn btn-link btn-sm" role="button">Already have an account?</a>
                        <div class="o_login_auth"/>
                    </div>
                </form>
            </t>
        </template>
        
        <template id="ldap_reset_password.signup_non_member" name="Sign up login">
            <t t-call="web.login_layout">
                <form class="oe_signup_form" role="form" method="post" t-if="not message">
                  <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <t t-call="ldap_reset_password.non_registered_fields">
                        <t t-set="only_passwords" t-value="bool(token and not invalid_token)"/>
                    </t>

                    <p class="alert alert-danger" t-if="error" role="alert">
                        <t t-esc="error"/>
                    </p>
                    <input type="hidden" name="redirect" t-att-value="redirect"/>
                    <input type="hidden" name="token" t-att-value="token"/>
                    <div class="text-center oe_login_buttons pt-3">
                        <button type="submit" class="btn btn-primary btn-block"> Sign up</button>
                        <a t-attf-href="/web/login?{{ keep_query() }}" class="btn btn-link btn-sm" role="button">Already have an account?</a>
                        <div class="o_login_auth"/>
                    </div>
                </form>
            </t>
        </template>

        <template id="ldap_reset_password.fields" name="Auth Signup/ResetPassword form fields">
            <div class="form-group field-name">
                <label for="first_name">First Name</label>               
                <input type="text" name="first_name" t-att-value="first_name" id="first_name" class="form-control form-control-sm" placeholder="e.g. John"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="last_name">Last Name</label>
                <input type="text" name="last_name" t-att-value="last_name" id="last_name" class="form-control form-control-sm" placeholder="e.g. Smith"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="text" name="email" t-att-value="email" id="email" class="form-control form-control-sm" placeholder="e.g. example@example.com"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="rotary_id">Rotary International Number (5-8 digits) </label>
                <input type="number" name="rotary_id" t-att-value="rotary_id" id="rotary_id" class="form-control form-control-sm" placeholder="e.g. 83314"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" min="10000" max="99999999"/>
            </div>

            <div class="form-group">
                <label for="rotary_club_id" string="Rotary Club">Rotary Club</label>            
                <select name="rotary_club_id" class="form-control form-control-sm" required="required" t-att-readonly="'readonly' if only_passwords else None" t-att-autofocus="'autofocus' if login and not only_passwords else None">
                    <option value="">-- Select a Club --</option>
                    <t t-foreach="clubs" t-as="club">
                        <option t-att-value="club.id" t-esc="club.name"/>
                    </t>
                </select>
            </div>
          
            <div class="form-group field-password pt-2">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" class="form-control form-control-sm"
                    required="required" t-att-autofocus="'autofocus' if only_passwords else None"/>
            </div>
            <div class="form-group field-confirm_password">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" name="confirm_password" id="confirm_password" class="form-control form-control-sm" required="required"/>
            </div>
        </template>

        <template id="ldap_reset_password.non_registered_fields" name="Auth Signup/ResetPassword form fields">
            <div class="form-group field-name">
                <label for="first_name">First Name</label>               
                <input type="text" name="first_name" t-att-value="first_name" id="first_name" class="form-control form-control-sm" placeholder="e.g. John"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="last_name">Last Name</label>
                <input type="text" name="last_name" t-att-value="last_name" id="last_name" class="form-control form-control-sm" placeholder="e.g. Smith"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="text" name="email" t-att-value="email" id="email" class="form-control form-control-sm" placeholder="e.g. example@example.com"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <!--div class="form-group">
                <label for="rotary_id">Rotary International Number (5-7 digits) </label>
                <input type="text" name="rotary_id" t-att-value="rotary_id" id="nrotary_id" class="form-control form-control-sm" placeholder="e.g. 83314"
                    required="required" t-att-readonly="'readonly' if only_passwords else None"
                    t-att-autofocus="'autofocus' if login and not only_passwords else None" />
            </div>
            <div class="form-group">
                <label for="rotary_club">Rotary Club</label>            
                <select name="rotary_club" id="rotary_club" class="form-control form-control-sm" required="required" t-att-readonly="'readonly' if only_passwords else None" t-att-autofocus="'autofocus' if login and not only_passwords else None">
                    <option value="9910">9910</option>
                    <option value="9920">9920</option>
                    <option value="9930">9930</option>
                    <option value="9940">9940</option>
                    <option value="9950">9950</option>
                    <option value="9960">9960</option>
                    <option value="9970">9970</option>
                    <option value="9980">9980</option>
                    <option value="9990">9990</option>
                </select>
            </div-->
            <div class="form-group field-password pt-2">
                <label for="password">Password</label>
                <input type="password" name="password" id="password" class="form-control form-control-sm"
                    required="required" t-att-autofocus="'autofocus' if only_passwords else None"/>
            </div>
            <div class="form-group field-confirm_password">
                <label for="confirm_password">Confirm Password</label>
                <input type="password" name="confirm_password" id="confirm_password" class="form-control form-control-sm" required="required"/>
            </div>
        </template>

        <template id="ldap_reset_password.template" name="Reset LDAP Password Form">
            <t t-call="web.login_layout">
                <form class="oe_reset_password_form" method="post">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <div class="form-group field-login">
                        <label for="login" class="col-form-label">Your Username</label>
                        <input type="text" name="login" t-att-value="login" id="login" class="form-control" autofocus="autofocus" required="required" autocapitalize="off"/>
                        
                        <label for="old_password" class="col-form-label">Old Password</label>
                        <input type="password" name="old_password" t-att-value="old_password" id="old_password" class="form-control" autofocus="autofocus" required="required" autocapitalize="off"/>
                        
                        <label for="new_passwd" class="col-form-label">New Password</label>
                        <input type="password" name="new_passwd" t-att-value="new_passwd" id="new_passwd" class="form-control" autofocus="autofocus" required="required" autocapitalize="off"/>
                    </div>

                    <div class="clearfix oe_login_buttons">
                        <button type="submit" class="btn btn-primary btn-block">Confirm</button>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                        </div>
                    </div>
                </form>
            </t>
        </template>

        <template id="ldap_reset_password.template_otp" name="Reset LDAP Password Form OTP">
            <t t-call="web.login_layout">
                <form class="oe_reset_password_form" method="post">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <div class="form-group field-login">
                        <label for="login" class="col-form-label">Your Username:</label>
                        <input type="text" name="login" t-att-value="login" id="login" class="form-control" autofocus="autofocus" required="required" autocapitalize="off"/>
                    </div>

                    <div class="clearfix oe_login_buttons">
                        <button type="submit" class="btn btn-primary btn-block">Confirm</button>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                        </div>
                    </div>
                </form>
            </t>
        </template>

        <record id="ldap_reset_password.invitation_email" model="mail.template">
            <field name="name">LDAP Invitation Email</field>
            <field name="model">res.users</field>
            <field name="subject">Welcome to ${object.company_id.name}</field>
            <field name="email_from">${ctx.get('email_from')}</field>
            <field name="partner_to">${object.partner_id.id}</field>
            <field name="body_html">
                <![CDATA[
                <table border="0" cellpadding="0" cellspacing="0" style="padding-top:16px;background-color: #F1F1F1; font-family:Verdana, Arial,sans-serif; color: #454748; width: 100%; border-collapse:separate;">
                    <tbody>
                        <!-- HEADER -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="padding:16px;background-color: white; color: #454748; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="middle">
                                                <span style="font-size:10px;">Your Account</span><br>
                                                <span style="font-size:20px;font-weight: bold;">
                                                    ${object.name}
                                                </span>
                                            </td>
                                            <td valign="middle" align="right">
                                                <img src="/logo.png?company=${object.company_id.id}" style="padding:0px;margin: 0px; height: auto; width: 80px;" alt="${object.company_id.name}">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" style="text-align:center;">
                                                <hr width="100%" style="background-color:rgb(204,204,204);border:medium none;clear:both;display:block;font-size:0px;min-height:1px;line-height:0; margin: 16px 0px 16px 0px;">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- CONTENT -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="min-width:590px;background-color: white; padding: 0px 8px 0px 8px; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="top" style="font-size:13px;">
                                                <div>
                                                    Dear ${object.name},<br><br>
                                                    Your username is: <strong>${object.login}</strong><br>
                                                    You may reset your password by following this link:<br>
                                                    <div style="margin: 16px 0px 16px 0px;">
                                                        <a href="/web/reset_ldap_password"
                                                            style="background-color: #009EFB; padding: 8px 16px 8px 16px; text-decoration: none; color: #fff; border-radius: 5px; font-size:13px;">
                                                            Reset password
                                                        </a>
                                                    </div>
                                                    If you did not expect this, you can safely ignore this email.<br><br>

                                                    Kind regards,
                                                    Administrator <br><br>
                                                    ${ctx.get('administrator_email')}
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:center;">
                                                <hr width="100%" style="background-color:rgb(204,204,204);border:medium none;clear:both;display:block;font-size:0px;min-height:1px;line-height:0; margin: 16px 0px 16px 0px;">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- FOOTER -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="min-width:590px;background-color: white; font-size: 11px; padding: 0px 8px 0px 8px; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="middle" align="left">
                                                ${object.company_id.name}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td valign="middle" align="left" style="opacity:0.7;">
                                                ${object.company_id.phone}
                                                % if object.company_id.email
                                                    | <a href="'mailto:%s' % ${object.company_id.email}" style="text-decoration:none; color: #454748;">${object.company_id.email}</a>
                                                % endif
                                                % if object.company_id.website
                                                    | <a href="'%s' % ${object.company_id.website}" style="text-decoration:none; color: #454748;">
                                                    ${object.company_id.website}
                                                </a>
                                                % endif
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- POWERED BY -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="min-width:590px; background-color: #F1F1F1; color: #454748; padding: 8px; border-collapse:separate;">
                                    <tr>
                                        <td style="text-align: center; font-size: 13px;">
                                            Powered by <a target="_blank" href="https://www.flectrahq.com?utm_source=db&amp;utm_medium=auth" style="color: #009EFB;">Flectra</a>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
                ]]>
            </field>
            <field name="lang">${object.lang}</field>
            <field name="auto_delete" eval="True"/>
        </record>



        <record id="ldap_reset_password.reset_ldap_password" model="mail.template">
            <field name="name">Reset LDAP Password Email</field>
            <field name="model">res.users</field>
            <field name="subject">${ctx.get('subject')}</field>
            <field name="email_from">${ctx.get('email_from')}</field>
            <field name="partner_to">${object.partner_id.id}</field>
            <field name="body_html">
                <![CDATA[
                <table border="0" cellpadding="0" cellspacing="0" style="padding-top:16px;background-color: #F1F1F1; font-family:Verdana, Arial,sans-serif; color: #454748; width: 100%; border-collapse:separate;">
                    <tbody>
                        <!-- HEADER -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="padding:16px;background-color: white; color: #454748; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="middle">
                                                <span style="font-size:10px;">Your Account</span><br>
                                                <span style="font-size:20px;font-weight: bold;">
                                                    ${object.name}
                                                </span>
                                            </td>
                                            <td valign="middle" align="right">
                                                <img src="/logo.png?company=${object.company_id.id}" style="padding:0px;margin: 0px; height: auto; width: 80px;" alt="${object.company_id.name}">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" style="text-align:center;">
                                                <hr width="100%" style="background-color:rgb(204,204,204);border:medium none;clear:both;display:block;font-size:0px;min-height:1px;line-height:0; margin: 16px 0px 16px 0px;">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- CONTENT -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="min-width:590px;background-color: white; padding: 0px 8px 0px 8px; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="top" style="font-size:13px;">
                                                <div>
                                                    Dear ${object.name},<br><br>

                                                    We have received a request to reset the password for your Flectra account associated with this email address.<br><br>
                                                    
                                                    Your One-Time Password (OTP) is: ${ctx.get('otp_code')} <br><br>

                                                    This code will expire in 15 minutes, if it expires you'll need to initiate a new password reset request. <br><br>

                                                    To continue the password reset process, please enter your OTP along with your new desired password on the same page where you initiated this email. <br><br>
                                                    
                                                    If you did not expect this, you can safely ignore this email as the link will automatically expire in 15 minutes. <br><br>
                                                    
                                                    Kind regards,
                                                    Administrator <br><br>

                                                    ${ctx.get('administrator_email')}
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:center;">
                                                <hr width="100%" style="background-color:rgb(204,204,204);border:medium none;clear:both;display:block;font-size:0px;min-height:1px;line-height:0; margin: 16px 0px 16px 0px;">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                        <!-- FOOTER -->
                        <tr>
                            <td align="center" style="min-width:590px;">
                                <table border="0" cellpadding="0" cellspacing="0" width="590" style="min-width:590px;background-color: white; font-size: 11px; padding: 0px 8px 0px 8px; border-collapse:separate;">
                                    <tbody>
                                        <tr>
                                            <td valign="middle" align="left">
                                                ${object.company_id.name}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td valign="middle" align="left" style="opacity:0.7;">
                                                ${object.company_id.phone}
                                                % if object.company_id.email
                                                    | <a href="'mailto:%s' % ${object.company_id.email}" style="color: #454748;">${object.company_id.email}</a>
                                                % endif
                                                % if object.company_id.website
                                                    | <a href="'%s' % ${object.company_id.website}" style="color: #454748;">
                                                    ${object.company_id.website}
                                                </a>
                                                % endif
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </td>
                        </tr>
                    </tbody>
                </table>
                ]]>
            </field>
        </record>

        <template id="ldap_reset_password.template_otp_entry" name="OTP Entry Form">
            <t t-call="web.login_layout">
                <style>
                    .strength {
                        height: 5px;
                        width: 100%;
                        margin-top: 5px;
                    }
                    .strength.weak {
                        background-color: red;
                    }
                    .strength.medium {
                        background-color: yellow;
                    }
                    .strength.strong {
                        background-color: green;
                    }
                    #password_error, #confirm_password_error {
                        color: red;
                        font-size: 12px;
                        margin-top: 5px;
                    }
                    #password-rules {
                        font-size: 0.8rem;
                        color: #666;
                        margin-bottom: 10px;
                    }

                    #password-rules ul {
                        padding-left: 20px;
                        margin-bottom: 0;
                    }

                    #password-rules li {
                        margin-bottom: 5px;
                    }
                </style>

                <div id="error_message" style="color: red;"></div>

                <form class="oe_reset_password_form" method="post">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    <input type="hidden" name="login" t-att-value="login"/>

                    <div class="form-group">
                        <label for="login" class="col-form-label">Your Username:</label>
                        <input type="text" class="form-control" t-att-value="login" readonly="readonly"/>
                    </div>

                    <div class="form-group">
                        <label for="otp" class="col-form-label">Enter One Time Password:</label>
                        <input type="text" name="otp" id="otp" class="form-control" required="required" autofocus="autofocus"/>
                    </div>
                
                    <div class="form-group">
                        <label for="new_password" class="col-form-label">New Password:</label>
                        <div id="password-rules" class="password-rules">
                            <strong>Password Rules:</strong>
                            <ul>
                                <li>At least 10 characters long</li>
                                <li>At least 1 lowercase letter</li>
                                <li>At least 1 uppercase letter</li>
                                <li>At least 1 number</li>
                                <li>At least 1 special character (!@#$%^&amp;*(),.?&quot;:{}|&lt;&gt;])</li>
                            </ul>
                        </div>
                        <input type="password" name="new_password" id="new_password" class="form-control" required="required"/>
                        <div id="password_strength" class="strength"></div>
                        <div id="password_error"></div>
                    </div>

                    <div class="form-group">
                        <label for="confirm_password" class="col-form-label">Confirm Password:</label>
                        <input type="password" name="confirm_password" id="confirm_password" class="form-control" required="required"/>
                        <div id="confirm_password_error"></div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Confirm</button>
                </form>

                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
                <script src="/ldap_reset_password/static/src/js/password_validation.js"></script>

            </t>
        </template>


        <template id="ldap_reset_password.thanks" name="Reset LDAP Password Thanks">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="thanksMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                            <a href="/web/reset_ldap_password">Reset Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.error" name="Reset LDAP Password Error">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="errorMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                            <a href="/web/reset_ldap_password">Reset Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.portal_error" name="Reset LDAP Password Error">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="errorMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/my/home">Back to My Portal</a>
                            <a href="/my/security">Change Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.portal_thanks" name="Reset LDAP Password Portal Thanks">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="thanksMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/my/home">Back to My Portal</a>
                            <a href="/my/security">Change Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.web_error" name="Reset LDAP Password Error">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="errorMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                            <a href="/web/reset_ldap_password">Change Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <template id="ldap_reset_password.web_thanks" name="Reset LDAP Password Web Thanks">
            <t t-call="web.login_layout">
                <div class="clearfix oe_login_buttons">
                    <form class="oe_reset_password_form">
                        <p id="thanksMessage" t-esc="message"/>
                        <div class="d-flex justify-content-between align-items-center small mt-2">
                            <a href="/web/login">Back to Login</a>
                            <a href="/web/reset_ldap_password">Change Password</a>
                        </div>
                    </form>
                </div>
            </t>
        </template>

        <record id="change_password_wizard_user_tree_view" model="ir.ui.view">
            <field name="name">Change Password Users</field>
            <field name="model">change.password.user</field>
            <field name="inherit_id" ref="base.change_password_wizard_user_tree_view"/>
            <field name="arch" type="xml">
                <xpath expr="//tree" position="replace">
                    <!-- the user list is editable, but one cannot add or delete rows -->
                    <tree string="Users" editable="bottom" create="false" delete="false">
                        <field name="user_id" invisible="1"/>
                        <field name="user_login"/>
                        <field name="new_passwd" required="True" password="True"/>
                    </tree>
                </xpath>
            </field>
        </record>

        <template id="portal.portal_my_security" name="My Profile Security">
            <t t-call="portal.portal_layout">
                <div class="o_portal_security_body">
                    <t t-set="additional_title">Security</t>
                    <t t-set="no_breadcrumbs" t-value="1"/>

                    <section>
                        <h3>Change Password</h3>
                        <button type="button" class="btn btn-danger" onclick="window.location.href='/web/reset_ldap_password'">Change Password</button>
                    </section>
                </div>
            </t>
        </template> 

        <record id="view_users_form_inherit" model="ir.ui.view">
            <field name="name">res.users.preferences.form.inherit</field>
            <field name="model">res.users</field>
            <field eval="18" name="priority"/>
            <field name="inherit_id" ref="base.view_users_form_simple_modif"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='preference_change_password']" position="replace">
                    <button name="preference_change_password" type="button" string="Change password" class="btn btn-danger" onclick="window.location.href='/web/reset_ldap_password'"/>
                </xpath>
            </field>
        </record>

        <!-- Server Action -->
        <record id="ldap_reset_password.action_clear_signup_urls" model="ir.actions.server">
            <field name="name">Clear Signup URLs</field>
            <field name="model_id" ref="base.model_res_users"/>
            <field name="state">code</field>
            <field name="code">model.clear_signup_urls()</field>
        </record>

        <!-- Action Window -->
        <record id="ldap_reset_password.action_res_users_clear_signup_urls" model="ir.actions.act_window">
            <field name="name">Clear Signup URLs</field>
            <field name="res_model">res.users</field>
            <field name="view_mode">list</field>
            <field name="binding_model_id" ref="base.model_res_users"/>
            <field name="binding_view_types">list</field>
            <field name="groups_id" eval="[(4, ref('base.group_no_one'))]"/>
        </record>

        <!-- Action Binding -->
        <record id="action_res_users_clear_signup_urls_binding" model="ir.actions.client">
            <field name="name">Clear Signup URLs</field>
            <field name="tag">action</field>
            <field name="target">new</field>
            <field name="binding_model_id" ref="base.model_res_users"/>
            <field name="params" eval="{'action_id': ref('ldap_reset_password.action_clear_signup_urls')}"/>
        </record>


    </data>
</flectra>